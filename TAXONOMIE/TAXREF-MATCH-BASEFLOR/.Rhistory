# Definition du repertoire de fichiers
WD = dirname(rstudioapi::getActiveDocumentContext()$path)
setwd(WD)
# Charger les bibliotheques necessaires
if(!require("readxl")){install.packages("readxl")} ; library("readxl")
if(!require("xlsx")){install.packages("xlsx")} ; library("xlsx")
if(!require("tidyverse")){install.packages("tidyverse")} ; library("tidyverse")
if(!require("rtaxref")){remotes::install_github("Rekyt/rtaxref")} ; library("rtaxref")
#Chargement de baseflor_bryo
baseflor_bryo <- read.csv("../CATMINAT/baseflor_bryo.csv",h=T)
baseflor_bryo$CD_NOM = "0"
baseflor_bryo$NOM_VALIDE = "NULL"
#Simplification des nom scientifique en retirant les auteurs
baseflor_bryo$NOM_SIMPLE = str_split(baseflor_bryo$NOM_SCIENTIFIQUE, "[:blank:][:upper:]",n=2, simplify = TRUE)[,1]
baseflor_bryo$NOM_SIMPLE = str_split(baseflor_bryo$NOM_SIMPLE, "\\(", n = 2, simplify = TRUE)[, 1]
baseflor_bryo$NOM_SIMPLE = str_split(baseflor_bryo$NOM_SIMPLE, "[:blank:]$", n = 2, simplify = TRUE)[, 1]
#Boucle de matching
for (i in 1:nrow(baseflor_bryo)){
cat(i,"\n")
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}
View(baseflor_bryo)
tryCatch({t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[318],version = "16.0"))
tryCatch(t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[318],version = "16.0"))
tryCatch(t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[318],version = "16.0"))
tryCatch(t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[318],version = "16.0"))
#Boucle de matching
for (317 in 1:nrow(baseflor_bryo)){
#Boucle de matching
for (i in 317:nrow(baseflor_bryo)){
cat(i,"\n")
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}
#Boucle de matching
for (i in 318:nrow(baseflor_bryo)){
cat(i,"\n")
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}
baseflor_bryo$NOM_SIMPLE[i]
#Boucle de matching
for (i in 318:nrow(baseflor_bryo)){
cat(i,"\n")
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "17.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}
#Boucle de matching
for (i in 1:nrow(baseflor_bryo)){
cat(i,"\n")
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "17.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}
tryCatch({
test = "bon"
}, error = function(e) {
i = 20
})
#Boucle de matching
for (i in 1:nrow(baseflor_bryo)){
cat(i,"\n")
tryCatch({
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "17.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}, error = function(e) {
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
})
}
View(baseflor_bryo)
#Boucle de matching
for (i in 1:nrow(baseflor_bryo)){
cat(i,"\n")
tryCatch({
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}, error = function(e) {
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
})
}
View(baseflor_bryo)
i = 10
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
t
View(t)
str_detect("test","s")
str_detect("Atriplex test x test","[:blank:]x[:blank:]")
str_detect("Atriplex testx test","[:blank:]x[:blank:]")
str_detect("Atriplex testx test","[:blank:]x[:blank:][:upper:]")
str_detect("Atriplex test x Test","[:blank:]x[:blank:][:upper:]")
View(t)
str_detect(t$scientificName,"[:blank:]x[:blank:]")
t[str_detect(t$scientificName,"[:blank:]x[:blank:]"),]
t[!str_detect(t$scientificName,"[:blank:]x[:blank:]"),]
#Boucle de matching
for (i in 1:nrow(baseflor_bryo)){
cat(i,"\n")
tryCatch({
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
#Supression des hybride
if(str_detect(baseflor_bryo$NOM_SIMPLE[i],"[:blank:]x[:blank:]")==FALSE){
t[!str_detect(t$scientificName,"[:blank:]x[:blank:]"),]
}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}, error = function(e) {
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
})
}
View(baseflor_bryo)
View(baseflor_bryo)
#Boucle de matching
for (i in 1:nrow(baseflor_bryo)){
cat(i,"\n")
tryCatch({
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
#Supression des hybride
if(str_detect(baseflor_bryo$NOM_SIMPLE[i],"[:blank:]x[:blank:]")==FALSE){
t = t[!str_detect(t$scientificName,"[:blank:]x[:blank:]"),]
}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}, error = function(e) {
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
})
}
View(baseflor_bryo)
#Boucle de matching
for (i in 1:nrow(baseflor_bryo)){
cat(i,"\n")
tryCatch({
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>1){t = t[t$id==t$referenceId,]}
if(nrow(t)>1 & nrow(t[t$rankId=="ES",])>1){t = t[t$rankId=="ES",]}
#Supression des hybride
if(str_detect(baseflor_bryo$NOM_SIMPLE[i],"[:blank:]x[:blank:]")==FALSE){
t = t[!str_detect(t$scientificName,"[:blank:]x[:blank:]"),]
}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}, error = function(e) {
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
})
}
View(t)
View(baseflor_bryo)
rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[2198],version = "16.0")
t[t$id==t$referenceId,]
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[2198],version = "16.0")
t
t[t$id==t$referenceId,]
nrow(t[t$id==t$referenceId,])>1
t[t$id==t$referenceId,]
nrow(t[t$id==t$referenceId,])>=1
View(baseflor_bryo)
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[72],version = "16.0")
t
ncol(t)>1
ncol(t)>=1
typeof(t)
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[73],version = "16.0")
View(t)
View(baseflor_bryo)
#Boucle de matching
for (i in 1:nrow(baseflor_bryo)){
cat(i,"\n")
tryCatch({
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>=1){t = t[t$id==t$referenceId,]}
if(nrow(t)>=1 & nrow(t[t$rankId=="ES",])>=1){t = t[t$rankId=="ES",]}
#Supression des hybride
if(str_detect(baseflor_bryo$NOM_SIMPLE[i],"[:blank:]x[:blank:]")==FALSE){
t = t[!str_detect(t$scientificName,"[:blank:]x[:blank:]"),]
}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}, error = function(e) {
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
})
}
#Boucle de matching
for (i in 105:nrow(baseflor_bryo)){
cat(i,"\n")
tryCatch({
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>=1){t = t[t$id==t$referenceId,]}
if(nrow(t)>=1 & nrow(t[t$rankId=="ES",])>=1){t = t[t$rankId=="ES",]}
#Supression des hybride
if(str_detect(baseflor_bryo$NOM_SIMPLE[i],"[:blank:]x[:blank:]")==FALSE){
t = t[!str_detect(t$scientificName,"[:blank:]x[:blank:]"),]
}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}, error = function(e) {
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
})
}
#Boucle de matching
for (i in 180:nrow(baseflor_bryo)){
cat(i,"\n")
tryCatch({
t = rt_taxa_search(sciname = baseflor_bryo$NOM_SIMPLE[i],version = "16.0")
if(ncol(t)>1){
if(nrow(t[t$id==t$referenceId,])>=1){t = t[t$id==t$referenceId,]}
if(nrow(t)>=1 & nrow(t[t$rankId=="ES",])>=1){t = t[t$rankId=="ES",]}
#Supression des hybride
if(str_detect(baseflor_bryo$NOM_SIMPLE[i],"[:blank:]x[:blank:]")==FALSE){
t = t[!str_detect(t$scientificName,"[:blank:]x[:blank:]"),]
}
baseflor_bryo$CD_NOM[i] = t$referenceId[1]
baseflor_bryo$NOM_VALIDE[i] = t$scientificName[1]}else{
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
}
}, error = function(e) {
baseflor_bryo$CD_NOM[i] = "NOMATCH"
baseflor_bryo$NOM_VALIDE[i] = "NOMATCH"
})
}
# Verification des différences
baseflor_bryo[baseflor_bryo$NOM_VALIDE!=baseflor_bryo$NOM_SIMPLE,]
# Verification des différences
difference = baseflor_bryo[baseflor_bryo$NOM_VALIDE!=baseflor_bryo$NOM_SIMPLE,]
View(difference)
write.csv2(baseflor_bryo,"baseflor_bryoTAXREFv16.csv",row.names = F,fileEncoding = "UTF-8",na="")
View(baseflor_bryo)
